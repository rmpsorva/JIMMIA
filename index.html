<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>JimmyA Digital Casino ðŸŽ° | La Fortuna de la Empanada</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --yellow: #FFD700;
      --green: #00FFC4;
      --pink: #FF69B4;
      --dark: #1a0f30;
      --light: #2c1a4b;
      --error: #FF4444;
      --success: #00C851;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--dark) url('https://i.imgur.com/n6Bf4vP.png') repeat;
      color: white;
      font-family: 'Poppins', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 2rem;
    }
    .container {
      background: var(--light);
      border-radius: 25px;
      padding: 2rem;
      border: 3px solid var(--yellow);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
      max-width: 700px;
      width: 100%;
      text-align: center;
      position: relative;
    }
    .ticker {
      font-family: 'Luckiest Guy', cursive;
      color: var(--green);
      font-size: 1.3rem;
      margin-bottom: 0.6rem;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { text-shadow: 0 0 5px var(--pink); }
      50% { text-shadow: 0 0 15px var(--yellow); }
      100% { text-shadow: 0 0 5px var(--pink); }
    }
    h1 {
      font-family: 'Luckiest Guy', cursive;
      color: var(--yellow);
      font-size: 2.8rem;
      margin-bottom: 0.5rem;
      text-shadow: 3px 3px 0px var(--pink);
    }
    .subtitle { color: #ddd; margin-bottom: 1.5rem; }
    .price-link {
      color: var(--green);
      font-weight: bold;
      text-decoration: none;
    }
    .slot-area {
      background: linear-gradient(45deg, #000, #222);
      padding: 2rem;
      border-radius: 20px;
      border: 5px solid var(--green);
      position: relative;
    }
    .slot-area img#jimmya-face {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 80px;
      opacity: 0.85;
      border-radius: 50%;
      box-shadow: 0 0 10px var(--pink);
    }
    .slot-reels {
      display: flex;
      justify-content: space-around;
      gap: 15px;
      overflow: hidden;
      height: 150px;
      align-items: center;
      margin-bottom: 1rem;
    }
    .slot-reel {
      width: 100px;
      height: 130px;
      background: var(--dark);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 3px solid var(--pink);
    }
    .slot-reel img { max-width: 90%; max-height: 90%; }
    #spin-btn {
      font-size: 1.5rem;
      padding: 1rem 2rem;
      background: linear-gradient(45deg, var(--green), #00e08f);
      color: var(--dark);
      border: 2px solid white;
      border-radius: 10px;
      cursor: pointer;
    }
    #spin-btn:hover:not(:disabled) { background: linear-gradient(45deg, #00e08f, var(--green)); }
    #spin-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .wallet-section, .connected-wallet {
      background: rgba(0, 0, 0, 0.3);
      border: 2px dashed var(--green);
      border-radius: 15px;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }
    .connected-wallet.hidden, .wallet-section.hidden { display: none; }
    .wallet-address {
      background: var(--dark);
      color: var(--green);
      padding: 0.8rem;
      border-radius: 8px;
      margin-top: 0.5rem;
      font-family: monospace;
    }
    .result-message { margin-top: 1rem; font-size: 1.3rem; color: var(--green); min-height: 40px; }
    footer {
      margin-top: 1rem;
      font-size: 0.8rem;
      color: #ccc;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="ticker" id="token-price">JIMMY-A $0.0000176 â€¢ Solana</div>
    <h1>JIMMYA DIGITAL CASINO</h1>
    <p class="subtitle">Â¡La Fortuna de la Empanada en Solana Devnet! ðŸš€</p>

    <div class="wallet-section" id="wallet-section">
      <p>Conecta tu Phantom Wallet:</p>
      <button id="connect-wallet-btn">ðŸ”— Conectar Phantom</button>
    </div>

    <div class="connected-wallet hidden" id="connected-wallet">
      <p>Wallet conectada:</p>
      <div class="wallet-address" id="wallet-address"></div>
      <p>Balance: <span id="balance">0.00</span> JIMMYA</p>
    </div>

    <div class="slot-area">
      <img id="jimmya-face" src="https://i.imgur.com/N7jP7P8.png" alt="JimmyA">
      <div class="slot-reels">
        <div class="slot-reel">?</div>
        <div class="slot-reel">?</div>
        <div class="slot-reel">?</div>
      </div>
      <p class="result-message" id="result-message">ðŸŽ° Â¡Gira para descubrir tu fortuna!</p>
      <button id="spin-btn" disabled>ðŸŽ° Â¡GIRAR!</button>
    </div>

    <footer>
      Pool: <code>DR1A9TWASuiAirq6KDbNXknZnH2C2wCVdqm1tDrUF6Wu</code><br>
      <a class="price-link" href="https://dex.coinmarketcap.com/token/Solana/54ocizWBC3CsD5L2Zr1kvVkLx5dFPUFzTJzv2J4zuray/" target="_blank">
        Ver en CoinMarketCap
      </a>
    </footer>
  </div>

  <script type="module">
    import { Connection, PublicKey, clusterApiUrl } from "https://cdn.jsdelivr.net/npm/@solana/web3.js@1.73.0/+esm";
    import { getAssociatedTokenAddress, getAccount } from "https://cdn.jsdelivr.net/npm/@solana/spl-token@0.3.9/+esm";

    const connectBtn = document.getElementById("connect-wallet-btn");
    const walletSection = document.getElementById("wallet-section");
    const connectedWallet = document.getElementById("connected-wallet");
    const walletAddress = document.getElementById("wallet-address");
    const balanceEl = document.getElementById("balance");
    const spinBtn = document.getElementById("spin-btn");
    const reels = document.querySelectorAll(".slot-reel");
    const resultMsg = document.getElementById("result-message");
    const tokenPriceEl = document.getElementById("token-price");

    const JIMMYA_MINT = new PublicKey("54ocizWBC3CsD5L2Zr1kvVkLx5dFPUFzTJzv2J4zuray");
    const TREASURY = new PublicKey("DR1A9TWASuiAirq6KDbNXknZnH2C2wCVdqm1tDrUF6Wu");
    const CONNECTION = new Connection(clusterApiUrl("devnet"));
    const BET_AMOUNT = 50;
    let wallet = null;

    async function fetchPrice() {
      try {
        const res = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=jimmya&vs_currencies=usd");
        const data = await res.json();
        const price = data.jimmya?.usd || 0.0000176;
        tokenPriceEl.textContent = `ðŸ’° JIMMY-A $${price.toFixed(7)} â€¢ Solana`;
      } catch {
        tokenPriceEl.textContent = "ðŸ’° JIMMY-A $0.0000176 â€¢ Solana";
      }
    }
    fetchPrice();
    setInterval(fetchPrice, 30000);

    async function connectWallet() {
      if (!window.solana || !window.solana.isPhantom) {
        alert("Instala Phantom Wallet para jugar.");
        return;
      }
      try {
        const resp = await window.solana.connect();
        wallet = resp.publicKey;
        walletSection.classList.add("hidden");
        connectedWallet.classList.remove("hidden");
        walletAddress.textContent = wallet.toString().slice(0,6) + "..." + wallet.toString().slice(-6);
        await updateBalance();
        spinBtn.disabled = false;
      } catch {
        alert("Error al conectar wallet.");
      }
    }

    async function updateBalance() {
      try {
        const ata = await getAssociatedTokenAddress(JIMMYA_MINT, wallet);
        const account = await getAccount(CONNECTION, ata);
        balanceEl.textContent = (Number(account.amount) / 1e9).toFixed(2);
      } catch {
        balanceEl.textContent = "0.00";
      }
    }

    const SYMBOLS = [
      "https://i.imgur.com/G4j3SgO.png",
      "https://i.imgur.com/vH1Zf9q.png",
      "https://i.imgur.com/gK6k2mP.png",
      "https://i.imgur.com/N7jP7P8.png",
      "https://i.imgur.com/T0b3o4R.png"
    ];

    function randomSymbol() {
      return `<img src="${SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)]}" alt="symbol">`;
    }

    function spin() {
      resultMsg.textContent = "Girando...";
      reels.forEach(r => r.innerHTML = "?");
      let spinCount = 0;
      const interval = setInterval(() => {
        reels.forEach(r => r.innerHTML = randomSymbol());
        spinCount++;
        if (spinCount > 20) {
          clearInterval(interval);
          const win = Math.random() < 0.25;
          resultMsg.textContent = win ? "ðŸŽ‰ Â¡Ganaste 150 JIMMYA!" : "ðŸ˜… IntÃ©ntalo de nuevo";
        }
      }, 100);
    }

    connectBtn.onclick = connectWallet;
    spinBtn.onclick = spin;
  </script>
</body>
</html>
